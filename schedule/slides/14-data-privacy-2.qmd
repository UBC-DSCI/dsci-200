---
lecture: "14 - Data Privacy II"
format: revealjs
metadata-files: 
  - _metadata.yml
---

{{< include _titleslide.qmd >}}

## Attribution
<br><br>

*This material is adapted from the following sources:* 

- [*Data Privacy Handbook*](https://utrechtuniversity.github.io/dataprivacyhandbook/)
- [*DSCI 541: Privacy, Ethics, and Security at UBC*](https://ubc-mds.github.io/course-descriptions/DSCI_541_priv-eth-sec/)
- [Harvard University Privacy Tools Project: Differential Privacy](https://privacytools.seas.harvard.edu/differential-privacy)

## Case Study: Brogan Inc. and NIHB Data

- The Non-Insured Health Benefits (NIHB) database contains sensitive health data on First Nations use of services like prescriptions, dental care, and medical devices.
- In 2001, Health Canada began releasing de-identified NIHB pharmacy claims data to Brogan Inc., a private health consulting firm.
- Though personal identifiers were removed, community identifiers remained, and First Nations were not informed until 2007.
- Brogan sold the data to pharmaceutical companies for commercial research and marketing
- Health Canada justified the release by claiming no privacy interests remained since personally identifying information had been removed.

> Kukutai, T., & Taylor, J. (2016). Indigenous data sovereignty: Toward an agenda. ANU press.

## Discussion

Take 5 minutes to discuss this case in groups of 2-3. Consider these questions to reflect on:

- Was the data truly de-identified? 
- Should de-identified data still require community consent before being shared or sold?
- What are the limits of simply removing names and IDs from a dataset?
- How can we measure whether a dataset is truly “safe” to release?

## Learning Objectives

By the end of today's lesson, you should be able to:

- Define identifiers, quasi-identifiers and sensitive attributes in data sets  
- Explain the limitations of basic deidentification methods  
- Describe the concepts of $k$-anonymity, $l$-diversity and $t$-closeness  
- Apply $k$-anonymity and $l$-diversity to de-identify data 
- Understand the basic idea of differential privacy and its significance  

## Why basic deidentification isn't always enough

- Last class, we introduced some techniques for deidentification such as suppression and generalization.

- However, individuals can often be re-identified using other information.

- As datasets become more detailed and linkable, privacy risks increase.

- Statistical methods are needed to ensure meaningful deidentification while preserving data utility.

## Statistical approaches to deidentification 
<br></br>

- $k$-anonymity  
- $l$-diversity  
- $t$-closeness  
- Differential privacy (advanced)

## Overview of privacy models

- $k$-anonymity, $l$-diversity, and $t$-closeness are **statistical approaches** that quantify the level of identifiability within a tabular dataset.  
- They focus on how variables combined can lead to identification.  
- These approaches are complementary: a dataset can be simultaneously $k$-anonymous, $l$-diverse, and $t$-close, where $k$, $l$, and $t$ represent numeric thresholds.
-  $k$-anonymity, $l$-diversity, and $t$-closeness are typically used to de-identify tabular datasets *before* sharing.
- They work best on relatively large datasets, where enough observations are present to preserve useful detail while still protecting privacy.


## Identifiers, Quasi-Identifiers, and Sensitive Attributes

Privacy models distinguish between three types of variables:

- **Identifiers:** Direct identifiers such as names, student numbers, email addresses.  

- **Quasi-Identifiers:**  Indirect identifiers that can lead to identification when combined with other quasi-identifiers or external data.  
	- Examples: age, sex, place of residence, physical characteristics, timestamps, etc.

- **Sensitive Attributes:** Variables of interest that need protection and cannot be altered as they are key outcomes.  
	- Examples: Medical condition, Income, etc.


## Importance of Correct Variable Categorization

:::incremental
- Correctly categorizing variables into identifiers, quasi-identifiers, and sensitive attributes is crucial.  
- This categorization determines how to de-identify your dataset effectively using $k$-anonymity, $l$-diversity, and $t$-closeness.
- Now, let's discuss each of these techniques in detail...
:::

## $k$-anonymity

:::incremental
- A data set is $k$-anonymous if each observation cannot be distinguished from at least $k-1$ other observations based on the quasi-identifiers.  
- This can be achieved through generalization, suppression and sometimes top- or bottom-coding of data values.
- Applying $k$-anonymity makes it more difficult for an attacker to single out or re-identify specific individuals.  
- It also helps reduce the risk of the mosaic effect, where combining data points could lead to identification.
:::

## Making a data set $k$-anonymous

:::incremental
1. Identify variables as identifiers, quasi-identifiers and sensitive attributes.  
2. Choose a value for $k$.  
3. Aggregate or transform the data so each combination of quasi-identifiers occurs at least k times.  
:::

## Choosing $k$ 

- There is no single correct value for $k$! 
- Higher $k$ increases privacy, but reduces data detail and utility.  
- The choice depends on promises made to data subjects and acceptable risk levels.

<div style="text-align: center;">
  ![](https://www.k2view.com/hubfs/K%20anonymity.png){width=600px}
  
  <small>
    Source: <a href="https://www.k2view.com/blog/what-is-k-anonymity" target="_blank">k2view.com</a>
  </small>
</div>

## Example data

- Age and city are quasi-identifiers, and salary is considered a sensitive attribute.

<table style="width: 80%; border-collapse: collapse; font-size: 90%; line-height: 1;">
  <thead>
    <tr>
      <th style="text-align: left; border-bottom: 1px solid #ccc; padding: 4px 8px;">Age</th>
      <th style="text-align: left; border-bottom: 1px solid #ccc; padding: 4px 8px;">City</th>
      <th style="text-align: left; border-bottom: 1px solid #ccc; padding: 4px 8px;">Salary</th>
    </tr>
  </thead>
  <tbody>
    <tr><td style="padding: 2px 8px;">32</td><td style="padding: 2px 8px;">Calgary</td><td style="padding: 2px 8px;">91,000</td></tr>
    <tr><td style="padding: 2px 8px;">37</td><td style="padding: 2px 8px;">Toronto</td><td style="padding: 2px 8px;">92,000</td></tr>
    <tr><td style="padding: 2px 8px;">31</td><td style="padding: 2px 8px;">Vancouver</td><td style="padding: 2px 8px;">82,000</td></tr>
    <tr><td style="padding: 2px 8px;">48</td><td style="padding: 2px 8px;">Calgary</td><td style="padding: 2px 8px;">115,000</td></tr>
    <tr><td style="padding: 2px 8px;">39</td><td style="padding: 2px 8px;">Vancouver</td><td style="padding: 2px 8px;">118,000</td></tr>
    <tr><td style="padding: 2px 8px;">37</td><td style="padding: 2px 8px;">Calgary</td><td style="padding: 2px 8px;">97,000</td></tr>
    <tr><td style="padding: 2px 8px;">34</td><td style="padding: 2px 8px;">Toronto</td><td style="padding: 2px 8px;">98,000</td></tr>
    <tr><td style="padding: 2px 8px;">33</td><td style="padding: 2px 8px;">Vancouver</td><td style="padding: 2px 8px;">89,000</td></tr>
    <tr><td style="padding: 2px 8px;">32</td><td style="padding: 2px 8px;">Toronto</td><td style="padding: 2px 8px;">108,000</td></tr>
    <tr><td style="padding: 2px 8px;">45</td><td style="padding: 2px 8px;">Calgary</td><td style="padding: 2px 8px;">95,000</td></tr>
  </tbody>
</table>


## $k=2$

<table>
  <thead>
    <tr><th>Age Range</th><th>City</th><th>Salary Range</th></tr>
  </thead>
  <tbody>
    <tr style="background-color: #FFEECC"><td>20–29</td><td>Calgary</td><td>90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td>30–39</td><td>Toronto</td><td>90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td>30–39</td><td>Vancouver</td><td>80,000–89,999</td></tr>
    <tr style="background-color: #FFDDEE"><td>40–49</td><td>Calgary</td><td>110,000–119,999</td></tr>
    <tr style="background-color: #EEFFCC"><td>30–39</td><td>Vancouver</td><td>110,000–119,999</td></tr>
    <tr style="background-color: #FFEECC"><td>20–29</td><td>Calgary</td><td>90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td>30–39</td><td>Toronto</td><td>90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td>30–39</td><td>Vancouver</td><td>80,000–89,999</td></tr>
    <tr style="background-color: #CCEEFF"><td>30–39</td><td>Toronto</td><td>100,000–109,999</td></tr>
    <tr style="background-color: #FFDDEE"><td>40–49</td><td>Calgary</td><td>90,000–99,999</td></tr>
  </tbody>
</table>


## $l$-diversity

- $l$-diversity is an extension of $k$-anonymity that ensures sufficient variation in a *sensitive attribute*. 
- This is important because if all individuals within a group share the same sensitive value, there is still a risk of inference.
- The approach requires at least $l$ different values for the sensitive attribute within each combination of quasi-identifiers.
- Again, there is no perfect value for $l$ (typically $1< l \leq k$).

## 

- Although these data are $2$-anonymous, we can still infer that any 30-39 year old from Calgary who participated earns between 90-99k. 

<table style="font-size: 90%; border-collapse: collapse;">
  <thead>
    <tr><th style="padding: 4px;">Age Range</th><th style="padding: 4px;">City</th><th style="padding: 4px;">Salary Range</th></tr>
  </thead>
  <tbody>
    <tr style="background-color: #FFEECC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Toronto</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Vancouver</td><td style="padding: 4px;">80,000–89,999</td></tr>
    <tr style="background-color: #FFDDEE"><td style="padding: 4px;">40–49</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">110,000–119,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Vancouver</td><td style="padding: 4px;">110,000–119,999</td></tr>
    <tr style="background-color: #FFEECC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Toronto</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Vancouver</td><td style="padding: 4px;">80,000–89,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">Toronto</td><td style="padding: 4px;">100,000–109,999</td></tr>
    <tr style="background-color: #FFDDEE"><td style="padding: 4px;">40–49</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">90,000–99,999</td></tr>
  </tbody>
</table>


## 

- With $l=2$, that means that for each combination of Age Range and City, there are at least 2 distinct Salary Ranges.

<table style="font-size: 90%; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="padding: 4px;">Age Range</th>
      <th style="padding: 4px;">City</th>
      <th style="padding: 4px;">Salary Range</th>
    </tr>
  </thead>
  <tbody>
    <tr style="background-color: #FFEECC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">80,000–89,999</td></tr>
    <tr style="background-color: #FFDDEE"><td style="padding: 4px;">40–49</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">110,000–119,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">110,000–119,999</td></tr>
    <tr style="background-color: #FFEECC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">90,000–99,999</td></tr>
    <tr style="background-color: #EEFFCC"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">80,000–89,999</td></tr>
    <tr style="background-color: #CCEEFF"><td style="padding: 4px;">30–39</td><td style="padding: 4px;">-</td><td style="padding: 4px;">100,000–109,999</td></tr>
    <tr style="background-color: #FFDDEE"><td style="padding: 4px;">40–49</td><td style="padding: 4px;">Calgary</td><td style="padding: 4px;">90,000–99,999</td></tr>
  </tbody>
</table>


## $t$-closeness

:::incremental
- $t$-closeness builds on k-anonymity and l-diversity by requiring that the distribution of the sensitive attribute within each group of quasi-identifiers is close to the distribution in the full dataset.
- This prevents situations where a sensitive value is overly dominant in a group, which could allow re-identification through skewed distributions.
- For example, in a dataset with Age and Sex as quasi-identifiers and Income as the sensitive attribute, applying t-closeness with $t = 0.1$ means the income distribution in each group must stay within 10\% of the overall income distribution.
- In this course, we will focus mainly on $k$-anonymity and $l$-diversity as $t$-closeness can get complicated to implement.
:::

## There are still issues...

- Even though the data is de-identified, some sensitive patterns can still leak through.

- In the example we discussed, both individuals are grouped into the same age range and city.

- While they are in different salary ranges and exact values are hidden, the range is still quite narrow.

- Due to the similarity of the salary ranges, one can still infer that both individuals earn between \$90,000 and \$119,999.

<table>
  <thead>
    <tr><th>Age Range</th><th>City</th><th>Salary Range</th></tr>
  </thead>
  <tbody>
    <tr style="background-color: #FFDDEE"><td>40–49</td><td>Calgary</td><td>110,000–119,999</td></tr>
    <tr style="background-color: #FFDDEE"><td>40–49</td><td>Calgary</td><td>90,000–99,999</td></tr>
  </tbody>
</table>

## Differential privacy

- So, we may need more sophisticated tools to privatize our data...
- Differential privacy is a mathematical approach to protecting privacy
- It ensures algorithm results are nearly the same whether one person’s data is included or not
- Differential privacy makes it hard to tell if any individual’s data is in the dataset, which protects individual's information (even with unusual or unique data)

## 

<center>
<img src="https://miro.medium.com/v2/resize:fit:1400/1*zRpTLYBAfumNAZIM7mZkXw.png" alt="Differential Privacy Example" width="70%">

<br>

<span style="font-size: 0.8em;">
Source: <a href="https://medium.com/data-science/a-differential-privacy-example-for-beginners-ef3c23f69401">https://medium.com/data-science/a-differential-privacy-example-for-beginners-ef3c23f69401</a>
</span>
</center>

##

- Differential privacy is a complex topic and goes beyond the scope of this course  
- For a clear and accessible explanation, check out this short video:

<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gI0wk1CXlsQ" title="Differential Privacy — Simply Explained" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>


## iClicker Question 1

Given the data, which **single** field could you generalize to help achieve **k = 3 anonymity**?

<div style="font-size:0.8em; max-width: 400px; margin: auto;">

| Age | ZIP Code | Disease   |
|-----|----------|-----------|
| 29  | 13053    | Flu       |
| 27  | 13068    | Flu       |
| 28  | 13068    | Cold      |
| 45  | 14853    | Diabetes  |
| 46  | 14853    | Diabetes  |
| 47  | 14853    | Cancer    |

</div>

- A. Generalize Age into age ranges (e.g., 20–29, 40–49)  
- B. Suppress Disease entirely  
- C. Generalize ZIP Code to first 3 digits (e.g., 130**, 148**)  
- D. Remove the 3rd row  
- E. It's already $k=3$ anonymous

## iClicker Question 2

Which of the following datasets violates $k = 2$ anonymity?

::: columns

:::: column

**Option A**

| Age | Sex | ZIP   |
|-----|--------|-------|
| 34  | M      | 02138 |
| 34  | M      | 02138 |
| 34  | F      | 02139 |

::::

:::: column

**Option B**

| Age | Sex | ZIP   |
|-----|--------|-------|
| 22  | F      | 10011 |
| 22  | F      | 10011 |
| 22  | F      | 10011 |

::::

:::: column

**Option C**

| Age Range | Sex | ZIP Prefix |
|-----------|--------|------------|
| 30–39     | *      | 021**      |
| 30–39     | *      | 021**      |
| 30–39     | *      | 021**      |

::::

:::

- A. Only A  
- B. Only B  
- C. Only C  
- D. A and B  



## Question 3

Consider this 3-anonymous dataset. Is it also 2-diverse with respect to "Condition"?

<div style="font-size:0.8em; max-width: 400px; margin: auto;">

| Age Range | ZIP Prefix | Condition |
|-----------|------------|-----------|
| 20–29     | 130**      | Flu       |
| 20–29     | 130**      | Flu       |
| 20–29     | 130**      | Flu       |
| 30–39     | 148**      | Cold      |
| 30–39     | 148**      | Cold      |
| 30–39     | 148**      | Cancer    |

</div>

- A. Yes, both groups have 2 or more different values  
- B. No, one group violates l-diversity  
- C. Yes, because the dataset is already k-anonymous  
- D. No, both groups have only one distinct value  


## Key Takeaways

- Removing direct identifiers alone does not guarantee privacy  
- Quasi-identifiers can lead to re-identification if not protected  
- $k$-anonymity makes each record indistinguishable from at least $k - 1$ others
- $l$-diversity improves protection by promoting diversity in sensitive attributes 
- Differential privacy offers mathematical privacy guarantees  
- Choosing privacy parameters involves balancing risk and data utility 


