{
  "hash": "2bff2a4bdd6bc3febb37ca44bbe48442",
  "result": {
    "engine": "knitr",
    "markdown": "---\nlecture: \"Imputation\"\nformat: revealjs\nmetadata-files: \n  - _metadata.yml\n---\n\n\n## {{< meta lecture >}} {.large background-image=\"img/smooths.png\" background-opacity=\"0.3\" background-size=\"50%\"}\n\n[DSCI 200]{.secondary}\n\n[{{< meta author >}}]{.secondary}\n\nLast modified -- 23 February 2026\n\n\n\n\n\n$$\n\\DeclareMathOperator*{\\argmin}{argmin}\n\\DeclareMathOperator*{\\argmax}{argmax}\n\\DeclareMathOperator*{\\minimize}{minimize}\n\\DeclareMathOperator*{\\maximize}{maximize}\n\\DeclareMathOperator*{\\find}{find}\n\\DeclareMathOperator{\\st}{subject\\,\\,to}\n\\newcommand{\\E}{E}\n\\newcommand{\\Expect}[1]{\\E\\left[ #1 \\right]}\n\\newcommand{\\Var}[1]{\\mathrm{Var}\\left[ #1 \\right]}\n\\newcommand{\\Cov}[2]{\\mathrm{Cov}\\left[#1,\\ #2\\right]}\n\\newcommand{\\given}{\\ \\vert\\ }\n\\newcommand{\\X}{\\mathbf{X}}\n\\newcommand{\\x}{\\mathbf{x}}\n\\newcommand{\\y}{\\mathbf{y}}\n\\newcommand{\\P}{\\mathcal{P}}\n\\newcommand{\\R}{\\mathbb{R}}\n\\newcommand{\\norm}[1]{\\left\\lVert #1 \\right\\rVert}\n\\newcommand{\\snorm}[1]{\\lVert #1 \\rVert}\n\\newcommand{\\tr}[1]{\\mbox{tr}(#1)}\n\\newcommand{\\brt}{\\widehat{\\beta}^R_{s}}\n\\newcommand{\\brl}{\\widehat{\\beta}^R_{\\lambda}}\n\\newcommand{\\bls}{\\widehat{\\beta}_{ols}}\n\\newcommand{\\blt}{\\widehat{\\beta}^L_{s}}\n\\newcommand{\\bll}{\\widehat{\\beta}^L_{\\lambda}}\n\\newcommand{\\U}{\\mathbf{U}}\n\\newcommand{\\D}{\\mathbf{D}}\n\\newcommand{\\V}{\\mathbf{V}}\n$$\n\n\n\n\n## Attribution\n<br><br>\n\nThis material is based on content from the following sources:\n\n- [*The Missing Book*](https://tmb.njtierney.com)\n- [*Flexible Imputation of Missing Data*](https://stefvanbuuren.name/fimd/)\n\n<br><br>\n\n## Learning Objectives \n<br><br>\nBy the end of this lesson, you will be able to:\n\n:::incremental\n- Justify and apply strategies for managing the missing data.\n- Write a computer script to impute missing values when appropriate\n- Write a computer script to evaluate the impact that missing data can have on subsequent analyses through simulation.\n- Reflect on the consequences with regards to the conclusions of the chosen method.\n- Recognize the importance of utilizing domain knowledge when handling missing data.\n:::\n\n## Review\n\nBefore the midterm we  \n\n:::incremental\n- introduced the problem of missing data  \n\n- learned different ways to diagnose missingness\n\n- defined different missing data mechanisms \n\n- used `R` functions from `naniar` package, integrated with  tidyverse workflow, to analyzed data\n\n- introduced some imputation methods\n\n:::\n\n## Some more details about imputation\n\n:::incremental\n- Imputation is not always the solution to missing data\n\n- Imputation can reinforce existing biases.\n  - For example, imputing variables like, age, race, gender may introduce biases to the analysis, particularly if missingness is related to social factors.\n\n- In other cases, imputation may mask trends in the data over time.\n\n- The percentage of missing data matters: <span style=\"color: green;\">less than 5%</span> is generally considered safe to impute; <span style=\"color: orange;\">5%–20%</span> is often acceptable but requires careful diagnostics; <span style=\"color: brown;\">20%–40%</span> calls for caution; and <span style=\"color: red;\">more than 40%</span> are typically unreliable.  \n\n- When missing data cannot be recovered, it is important to understand why the data are missing and to analyze them accordingly.\n:::\n\n## Types of imputation\n\n![](img/listwise_del.png)\n\n## Listwise Deletion\n\nRetain only complete observations\n\n- Simple and widely used \n\n- Unbiased under MCAR\n\n- Biased under MAR in many cases\n\n- Inefficient (larger standard errors due to smaller sample size)\n\n- Discards potentially useful data\n\n\n## Deterministic Methods - I\n\nImputation using a fix value (e.g., the mean, median, or mode of each variable)\n\n- Replaces missing values using the observed data\n\n- Simple and fast to apply\n\n- Reduces variance \n\n- Introduces bias in relationships among variables\n\n- Ignores imputation uncertainty\n\n## \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(simputation)\nlibrary(naniar)\nlibrary(visdat)\nlibrary(ggplot2)\nlibrary(tidyverse)\n\nset.seed(123)\n\nn <- 100\nx1 <- rnorm(n)\nx2 <- rnorm(n) + x1\ny  <- 2 * x1 + 1.5 * x2 + rnorm(n)\n\nm <- sum(x1 > 0)\n\nset.seed(123)\nmissing_idx2 <- sample(seq_len(m), size = round(0.5 * m))  # 50% missing\nmissing_idx1 <- sample(seq_len(m), size = round(0.3 * m))\n\n# introduce MAR\nx2[x1 > 0][missing_idx2] <- NA\n\n# introduce MNAR\nx1[x1 > 0][head(missing_idx1)] <- NA\n\nsimulated_data <- data.frame(x1, x2, y)\n```\n:::\n\n\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsimulated_data |>\n  nabular() |>\n  add_label_shadow() |>\n  mutate(across(where(is.numeric), impute_mean)) |> \n  ggplot(aes(x = x1,\n             y = x2,\n             colour = any_missing)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](imputation_files/figure-revealjs/unnamed-chunk-2-1.svg){fig-align='center'}\n:::\n:::\n\n\n\n## Deterministic Methods - II \n\n**Statistical Prediction Models**\n\nReplaces missing values with predictions from an estimated model (e.g., linear regression) using observed values of other variables\n\n  - Preserves relationships between variables\n  \n  - Assumes relationships that may not be valid\n  \n  - Ignores imputation uncertainty\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsimulated_imp_lm <- simulated_data |>\n  nabular() |>\n  add_label_shadow() |>\n  impute_lm(x2 ~ x1 + y)\n\nggplot(simulated_imp_lm,\n       aes(x = x2,\n           y = x1,\n           colour = any_missing)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](imputation_files/figure-revealjs/unnamed-chunk-3-1.svg){fig-align='center'}\n:::\n:::\n\n\n\n## Multiple imputation (MI)\n\n![](https://stefvanbuuren.name/fimd/fig/ch01-miflow-1.png)\n\n::: {style=\"font-size: 20px; margin-top: -30px; color: grey;\"}\nFigure from [*Flexible Imputation of Missing Data](https://stefvanbuuren.name/fimd/)\n:::\n\n## MI\n\n- Assumes that missing data is either Missing Completely at Random (MCAR) or Missing at Random (MAR).\n\n- Reflects the uncertainty inherent in the missing data by introducing many randomly imputed values. \n\n- Gives unbiased parameter estimates\n\n- Retain the statistical relationships present in the data\n\n## MICE: Multivariate Imputation via Chained Equations\n\n**Initialization**: Replace missing values with simple initial guesses (e.g., mean or median of observed values).\n\n**Imputation**: For each variable with missing values, impute it using the other variables as predictors, based on a specified method (e.g., PMM, regression, tree-based methods), including random variation.\n\n**Iteration (`maxit`)**: Cycle through all variables multiple times to update the imputations.\n\n**Multiple Imputations**: Repeat to create `m` complete datasets.\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(mice)\nmice_imp <- simulated_data |>\n    mice(m = 5, maxit = 10, seed = 123, printFlag =  FALSE)\n\n#one dataset\ncomp_case <- complete(mice_imp, action = 1)\n\nmodel_mice1 <- lm(y ~ x1 + x2, data = comp_case)\nanswer14 <- summary(model_mice1)\nanswer14\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = y ~ x1 + x2, data = comp_case)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.27913 -0.61408 -0.09257  0.51997  2.34976 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  0.05243    0.09369    0.56    0.577    \nx1           1.82647    0.13584   13.45   <2e-16 ***\nx2           1.44413    0.09194   15.71   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.9278 on 97 degrees of freedom\nMultiple R-squared:   0.93,\tAdjusted R-squared:  0.9286 \nF-statistic: 644.6 on 2 and 97 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n## Visualizing imputation\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(mice)\n\nsim_with_flag <- simulated_data |>\n  mutate(any_missing = if_any(everything(), is.na))\n\nmice_imp <- mice(sim_with_flag, m = 5, maxit = 10,\n                 seed = 123, printFlag = FALSE)\n\ncomp_case <- complete(mice_imp, action = 1)\n\nggplot(comp_case,\n       aes(x = x2, y = x1, colour = any_missing)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](imputation_files/figure-revealjs/unnamed-chunk-5-1.svg){fig-align='center'}\n:::\n:::\n\n\n\n## MICE\n\n**Predictive Mean Matching (PMM)**\n\nAmong many methods implemented in `mice`, pmm is a popular and default option for imputation of continuous variables\n\n- For each variable with missing values, it fits a regression model using all other variables as predictors\n\n- Computes predicted values for each missing case using the estimated model\n\n- Finds donor candidates among observed cases with matching (close) predicted values\n\n- Randomly selects a donor from the nearest neighbors\n\n- Imputes with the observed value from the chosen donor \n\n### Keeps imputed values realistic and within range\n\n## Key Takeaways\n\n- Missing data do more than reduce sample size, they can distort who is represented and how variables are related\n\n- Diagnosing why data are missing is essential before choosing how to handle them\n\n- Complete-case analysis is a simple way to handle missingness but is unbiased only under MCAR and often fails otherwise  \n\n- MNAR poses the greatest risk of bias when handled incorrectly\n\n- Visualization and diagnostics are critical tools for identifying missingness mechanisms\n\n- `naniar` integrates missing-data summaries and visualizations into the tidyverse workflow using tidy data principles\n\n##\n\n- Many imputation methods exist but it is important to understand the risk of imputing!\n\n- Transparent reporting of imputation decisions is essential for reproducibility and ethical integrity.\n\n#### Check additional functions in the [Missing Book](https://tmb.njtierney.com/representing-missings)\n\n![](https://static.wikia.nocookie.net/narnia/images/4/4b/NarniaWardrobe.jpg){fig-align=\"center\" width=100%}\n",
    "supporting": [
      "imputation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}